{% extends "base.html" %}

{% block title %}Manage {{ course.title }} - SkillSwap{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">{{ course.title }}</h4>
                    <span class="badge bg-{{ course.is_free|yesno:'success,primary' }}">
                        {{ course.is_free|yesno:"Free,Paid" }}
                    </span>
                </div>
                <div class="card-body">
                    <p>{{ course.description }}</p>
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">Skill: {{ course.skill.name }}</small>
                        <small class="text-muted">Level: {{ course.get_level_display }}</small>
                    </div>
                </div>
            </div>

            <!-- Add Module Form -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Add Module</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="add_module" value="1">
                        
                        <div class="mb-3">
                            <label for="module_title" class="form-label">Module Title</label>
                            <input type="text" class="form-control" id="module_title" name="module_title" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="module_description" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="module_description" name="module_description" rows="2"></textarea>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Add Module</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Course Modules -->
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Course Modules</h5>
                </div>
                <div class="card-body">
                    {% if modules %}
                    <div class="list-group">
                        {% for module in modules %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h5 class="mb-0">{{ module.title }}</h5>
                                <div>
                                    <button class="btn btn-sm btn-outline-danger">Delete</button>
                                </div>
                            </div>
                            
                            {% if module.description %}<p class="text-muted">{{ module.description }}</p>{% endif %}
                            
                            <!-- Add Content Form -->
                            <form method="post" class="mb-3">
                                {% csrf_token %}
                                <input type="hidden" name="add_content" value="1">
                                <input type="hidden" name="module_id" value="{{ module.id }}">
                                
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label for="title" class="form-label">Content Title</label>
                                        <input type="text" class="form-control" id="title" name="title" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="content_type" class="form-label">Content Type</label>
                                        <select class="form-select" id="content_type" name="content_type" required>
                                            <option value="video">Video</option>
                                            <option value="article">Article</option>
                                            <option value="quiz">Quiz</option>
                                            <option value="assignment">Assignment</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="content" class="form-label">Content</label>
                                    <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="is_free_preview" name="is_free_preview">
                                    <label class="form-check-label" for="is_free_preview">Available as free preview</label>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary">Add Content</button>
                                </div>
                            </form>
                            
                            <!-- Module Contents -->
                            <div class="list-group">
                                {% for content in module.contents.all %}
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">{{ content.title }}</h6>
                                            <small class="text-muted">{{ content.get_content_type_display }}</small>
                                        </div>
                                        <div>
                                            {% if content.is_free_preview %}
                                            <span class="badge bg-success me-2">Free Preview</span>
                                            {% endif %}
                                            <button class="btn btn-sm btn-outline-danger">Delete</button>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="alert alert-info">No content added yet</div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="alert alert-info">No modules added yet</div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Course Actions</h5>
                </div>
                <div class="card-body">
                    <a href="{% url 'courses:course_detail' course.id %}" class="btn btn-outline-primary w-100 mb-2">
                        View Course
                    </a>
                    <a href="#" class="btn btn-outline-success w-100 mb-2">
                        Publish Course
                    </a>
                    <a href="#" class="btn btn-outline-danger w-100">
                        Delete Course
                    </a>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Course Thumbnail</h5>
                </div>
                <div class="card-body text-center">
                    {% if course.thumbnail %}
                    <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" class="img-fluid rounded mb-3">
                    {% else %}
                    <div class="bg-light rounded p-5 text-muted mb-3">
                        No thumbnail uploaded
                    </div>
                    {% endif %}
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="file" class="form-control" id="thumbnail" name="thumbnail" accept="image/*">
                            <button class="btn btn-outline-secondary" type="submit">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}